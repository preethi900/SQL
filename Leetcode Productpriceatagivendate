select product_id, new_price as price
from Products
where (product_id, change_date) in (
    select distinct  product_id, max(change_date) over(partition by product_id) as last_date
    from Products
    WHERE change_date <= '2019-08-16'
)
union
select product_id, 10 as price
from Products
where product_id not in (
    select distinct product_id
    from Products
    where change_date <= '2019-08-16'
)
